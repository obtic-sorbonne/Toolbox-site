{% extends "index.html" %}
{% block header %} {{ super() }} {% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename= 'css/elements.css') }}">
<div class="outil">
    <div class="fil"><a href="{{ url_for('generation_texte')}}"><< {{ _('Retour aux tâches') }}</a></div>
    <h2>{{ _('Complétion de texte') }}</h2>
    <p>{{ _("Génération automatique d'un texte cohérent et contextuellement pertinent en fonction d'une invite ou d'une entrée donnée") }}.</p>
    <br>
    <p style="text-align: center;padding:20px"><a href="{{ url_for('documentation_generation') }}" target="_blank">{{ _('Voir la documentation') }}</a> / <a href="{{ url_for('tutoriel_generation') }}" target="_blank">{{ _('Voir le tutoriel') }}</a></p>
    <br>
    
    <form action="{{ url_for('completion_text') }}" method="post" enctype="multipart/form-data" onsubmit="showloader('loader')">
        <div class="form-group">
            <label for="prompt">{{ _('Amorce de texte (prompt)') }} :</label>
            <textarea name="prompt" id="prompt" rows="4" cols="50" required>{% if request.form.prompt %}{{ request.form.prompt }}{% else %}This training allows you to{% endif %}</textarea>
        </div>
        
        <div class="form-group">
            <label for="max_length">{{ _('Longueur maximale (tokens)') }} :</label>
            <input type="number" name="max_length" id="max_length" min="20" max="200" value="{% if request.form.max_length %}{{ request.form.max_length }}{% else %}60{% endif %}">
        </div>
        
        <input id="csrf_token" name="csrf_token" type="hidden" value="{{ csrf_token() }}">
        
        <button type="submit" style="display:block;margin:auto;margin-top:20px;">{{ _('Générer le texte') }}</button>
    </form>

    {% if error %}
    <div class="error-message">
        <p>{{ error }}</p>
    </div>
    {% endif %}

    {% if result %}
    <div class="result-container">
        <h4>{{ _('Texte généré') }} :</h4>
        <div class="result-text">
            {{ result }}
        </div>
    </div>
    {% endif %}
    
    <div class="loader" id="loader">
        <div class="loadingio-spinner-ball-205vl2x7n"><div class="ldio-b8p5li8dt1u"><div></div></div></div>
        <p>Traitement en cours...</p>
    </div>

<script>
function showloader(id) {
    document.getElementById(id).style.display = 'block';
}
/* MAJ de la zone de glisser-déposer */ 
$('form input').change(function () {
    var nb_files = this.files.length;
    $('form #form_msg').text(nb_files + " fichier(s) selectionné(s)");

    /* Prévisualisation des fichiers chargés (max 3 visibles) */
    if(nb_files > 3){
        var num = nb_files - 3;
        for(i=0; i < 3; i++){
            $("#form_msg").append('<br/><span class="filename_preview">' + this.files[i].name + '</span>');
        }
        $("#form_msg").append('<span class="filename_preview"> et ' + num + ' autres.</span>');
    }
    else{
        for(i=0; i < nb_files; i++){
            $("#form_msg").append('<br/><span class="filename_preview">' + this.files[i].name + '</span>');
        }
    }
});
</script>
</div>
{% endblock %}
{% block footer %} {{ super() }} {% endblock %}