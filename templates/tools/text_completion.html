{% extends "index.html" %}
{% block header %} {{ super() }} {% endblock %}

{% block content %}
<style>
    
  label, input {
  display: inline-block; /* Pour qu'ils puissent être sur la même ligne */
  vertical-align: middle; /* Aligne verticalement au centre si besoin */
  margin-bottom: 0; /* Supprime le margin-bottom sur le select */
}

label {
  margin-right: 10px; /* Un peu d'espacement entre le label et le select */
  font-weight: bold;
}

input {
  width: 25%; /* Ou une largeur fixe si tu veux */
  padding: 8px;
  box-sizing: border-box;
  border: 2px solid #263e8d;
  border-radius: 4px;
  background-color: #fff;
}

  select, textarea {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    box-sizing: border-box;
  border: 2px solid #263e8d;
    border-radius: 4px;
    background-color: #fff;
  }

</style>

<link rel="stylesheet" href="{{ url_for('static', filename= 'css/elements.css') }}">
<div class="outil">
    <div class="fil"><a href="{{ url_for('text_generation')}}"><< {{ _('Retour aux tâches') }}</a></div>
    <h2>{{ _('Complétion de texte') }}</h2>
    <p>{{ _("Cet outil utilise des modèles d’intelligence artificielle entraînés sur de grandes quantités de texte pour produire des contenus à la demande. À partir d’une instruction ou d’un court message d’entrée, il analyse le contexte, comprend le sujet, puis génère une réponse complète et structurée, adaptée au style souhaité") }}.
    {{ _("Grâce aux techniques de traitement du langage naturel, il peut créer rapidement des textes clairs, cohérents et sur mesure, que ce soit pour rédiger des descriptions, des articles, des emails ou d’autres contenus écrits. Facile à intégrer dans vos projets, il vous fait gagner du temps tout en garantissant une bonne qualité rédactionnelle") }}.
</p>
    <br>
    <p style="text-align: center;padding:20px"><a href="{{ url_for('documentation_generation') }}"  target="_blank">{{ _('Voir la documentation') }}</a></p>
    <br>
    <div class="infos_outil" style="display: block;margin: 0 auto 15px auto;">
        <input id="show" type=checkbox><label for="show" class="infos_title" style="font-weight:normal;"><i class="fa-solid fa-circle-info"></i> {{ _("Informations sur l'outil") }}<i class="fa-solid fa-angle-right" style="float:right;margin-top:5px;margin-left:15px;cursor: pointer;"></i></label>
        <div class="info_popped">
          <p>Transformers
      <p>{{ _("Modèle ")}}:  <a href="https://huggingface.co/bigscience/bloom-560m" target="_blank">bigscience/bloom-560m</a></p>
      <p>{{ _("Langues supportées ")}}: <i class="fa-solid fa-language"></i> {{ _("46 langues (surtout langues occidentales)")}}</p>
      <p>{{ _("Longueur : Entre 20 et 200 tokens")}}</p>
      <p><i class="fa-solid fa-triangle-exclamation"></i> {{ _("Attention : Le modèle utilisé est assez lourd<br> donc le traitement peut être un peu long")}}.</p>
      </div>
  </div>
  <br>
    <form action="{{ url_for('completion_text') }}" method="post" enctype="multipart/form-data" onsubmit="showloader('loader')">
        <div class="form-group">
            <label style="margin-bottom: 10px;" for="prompt">{{ _('Amorce de texte (prompt)') }} :</label><br>
            <textarea name="prompt" id="prompt" rows="4" cols="50" required>{% if request.form.prompt %}{{ request.form.prompt }}{% else %}{{ _('Saisissez votre texte ici...') }}{% endif %}</textarea>
        </div>
        <br>
        <div class="form-group">
            <label for="max_length">{{ _('Longueur maximale (tokens)') }} :</label>
            <input type="number" name="max_length" id="max_length" min="20" max="200" value="{% if request.form.max_length %}{{ request.form.max_length }}{% else %}60{% endif %}">
        </div>
        <br>
        
        <input id="csrf_token" name="csrf_token" type="hidden" value="{{ csrf_token() }}">
        
        <button type="submit" style="display:block;margin:auto;margin-top:20px;">{{ _('Générer le texte') }}</button>
        <br>
    </form>

    {% if error %}
    <div class="error-message">
        <p>{{ error }}</p>
    </div>
    {% endif %}

    {% if result %}
    <div class="result-container">
        <h4>{{ _('Texte généré') }} :</h4>
        <div class="result-text">
            {{ result }}
        </div>
    </div>
    {% endif %}
    
    <div class="loader" id="loader">
        <div class="loadingio-spinner-ball-205vl2x7n"><div class="ldio-b8p5li8dt1u"><div></div></div></div>
        <p>{{ _('Traitement en cours...') }}</p>
    </div>

<script>
function showloader(id) {
    document.getElementById(id).style.display = 'block';
}
/* MAJ de la zone de glisser-déposer */ 
$('form input').change(function () {
    var nb_files = this.files.length;
    $('form #form_msg').text(nb_files + " fichier(s) selectionné(s)");

    /* Prévisualisation des fichiers chargés (max 3 visibles) */
    if(nb_files > 3){
        var num = nb_files - 3;
        for(i=0; i < 3; i++){
            $("#form_msg").append('<br/><span class="filename_preview">' + this.files[i].name + '</span>');
        }
        $("#form_msg").append('<span class="filename_preview"> et ' + num + ' autres.</span>');
    }
    else{
        for(i=0; i < nb_files; i++){
            $("#form_msg").append('<br/><span class="filename_preview">' + this.files[i].name + '</span>');
        }
    }
});
</script>
</div>
{% endblock %}
{% block footer %} {{ super() }} {% endblock %}